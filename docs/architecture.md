# Imaginary 项目架构文档

## 1. 架构概述

Imaginary 采用现代化的微服务架构，将系统分为前端应用、后端服务和数据存储三个主要部分。系统设计遵循高内聚低耦合的原则，各组件通过定义良好的API进行通信，确保系统的可扩展性和可维护性。

## 2. 系统架构图

```
+----------------------------------+
|           用户界面层              |
|  +----------------------------+  |
|  |      Web 前端应用          |  |
|  +----------------------------+  |
+----------------------------------+
              |
              | HTTP/WebSocket
              v
+----------------------------------+
|           应用服务层              |
|  +------------+  +------------+  |
|  | 用户服务    |  | 图片上传服务 |  |
|  +------------+  +------------+  |
|                                  |
|  +------------+  +------------+  |
|  | 图像分析服务 |  | 自然语言处理 |  |
|  +------------+  +------------+  |
|                                  |
|  +------------+  +------------+  |
|  | 相册生成服务 |  | 图像处理服务 |  |
|  +------------+  +------------+  |
+----------------------------------+
              |
              | 数据访问
              v
+----------------------------------+
|           数据存储层              |
|  +------------+  +------------+  |
|  | 用户数据库   |  | 图片存储    |  |
|  +------------+  +------------+  |
|                                  |
|  +------------+  +------------+  |
|  | 图片元数据   |  | 向量数据库  |  |
|  +------------+  +------------+  |
+----------------------------------+
```

## 3. 组件详细说明

### 3.1 前端应用

#### 3.1.1 Web 前端应用
- **技术栈**：React.js, TypeScript, Tailwind CSS
- **功能**：
  - 用户界面渲染
  - 用户交互处理
  - 图片上传和预览
  - 自然语言命令输入
  - 图片库浏览和管理
  - 响应式设计，适配不同设备

### 3.2 应用服务层

#### 3.2.1 用户服务
- **技术栈**：Node.js/Express 或 Python/FastAPI
- **功能**：
  - 用户注册和认证
  - 用户配置文件管理
  - 权限控制
  - 会话管理

#### 3.2.2 图片上传服务
- **技术栈**：Node.js/Express 或 Python/FastAPI
- **功能**：
  - 图片上传处理
  - 图片格式验证
  - 图片元数据提取
  - 图片存储管理

#### 3.2.3 图像分析服务
- **技术栈**：Python, PyTorch/TensorFlow
- **功能**：
  - 图像内容分析
  - 对象和场景识别
  - 图像质量评估
  - 文本描述生成
  - 特征提取和向量化

#### 3.2.4 自然语言处理服务
- **技术栈**：Python, Hugging Face Transformers
- **功能**：
  - 自然语言命令解析
  - 意图识别
  - 实体提取
  - RAG 查询处理
  - 响应生成

#### 3.2.5 相册生成服务
- **技术栈**：Python
- **功能**：
  - 智能相册创建
  - 图片分组和排序
  - 主题识别
  - 相册元数据管理

#### 3.2.6 图像处理服务
- **技术栈**：Python, OpenCV
- **功能**：
  - 基本图像编辑（裁剪、旋转等）
  - 滤镜应用
  - 图像增强
  - 批量处理

### 3.3 数据存储层

#### 3.3.1 用户数据库
- **技术**：PostgreSQL 或 MongoDB
- **存储内容**：
  - 用户账户信息
  - 用户配置文件
  - 用户偏好设置

#### 3.3.2 图片存储
- **技术**：对象存储（如 AWS S3, MinIO）
- **存储内容**：
  - 原始图片文件
  - 处理后的图片文件
  - 缩略图

#### 3.3.3 图片元数据
- **技术**：PostgreSQL 或 MongoDB
- **存储内容**：
  - 图片基本信息（文件名、大小、格式等）
  - 上传时间和位置
  - 用户添加的标签和描述
  - 系统生成的标签和描述
  - 图片分析结果

#### 3.3.4 向量数据库
- **技术**：Pinecone, Milvus 或 FAISS
- **存储内容**：
  - 图片特征向量
  - 文本描述向量
  - 用于相似性搜索的索引

## 4. 系统交互流程

### 4.1 图片上传和分析流程
1. 用户通过前端界面上传图片
2. 图片上传服务接收图片，验证格式和大小
3. 图片存储到对象存储中
4. 图片元数据记录到数据库
5. 图像分析服务处理图片，生成描述和特征
6. 图像特征向量存储到向量数据库
7. 分析结果更新到图片元数据

### 4.2 自然语言查询流程
1. 用户通过前端界面输入自然语言命令
2. 自然语言处理服务解析命令，识别意图和实体
3. 系统根据解析结果构建查询
4. 向量数据库执行相似性搜索
5. 系统获取匹配图片的元数据和内容
6. 前端展示查询结果

### 4.3 智能相册创建流程
1. 用户请求创建智能相册或系统自动触发
2. 相册生成服务分析用户图片库
3. 系统根据时间、地点、内容等因素分组图片
4. 系统生成相册元数据和结构
5. 前端展示生成的相册

## 5. 技术选型

### 5.1 前端技术
- **框架**：React.js
- **状态管理**：Redux 或 Context API
- **UI组件**：Material-UI 或 Ant Design
- **样式**：Tailwind CSS
- **构建工具**：Vite 或 Webpack

### 5.2 后端技术
- **API框架**：Node.js/Express 或 Python/FastAPI
- **图像处理**：Python, OpenCV, PIL
- **机器学习**：PyTorch, TensorFlow, Hugging Face Transformers
- **自然语言处理**：Hugging Face Transformers, spaCy

### 5.3 数据存储技术
- **关系型数据库**：PostgreSQL
- **NoSQL数据库**：MongoDB
- **对象存储**：AWS S3, MinIO
- **向量数据库**：Pinecone, Milvus, FAISS

### 5.4 基础设施
- **容器化**：Docker
- **编排**：Kubernetes 或 Docker Compose
- **CI/CD**：GitHub Actions 或 GitLab CI
- **监控**：Prometheus, Grafana

## 6. 安全架构

### 6.1 认证和授权
- JWT 或 OAuth2.0 认证
- 基于角色的访问控制
- API 密钥管理

### 6.2 数据安全
- 数据加密（传输中和静态）
- 敏感信息保护
- 图片内容安全检查

### 6.3 基础设施安全
- 网络隔离
- 防火墙配置
- 定期安全审计

## 7. 扩展性考虑

### 7.1 水平扩展
- 无状态服务设计
- 负载均衡
- 数据库分片

### 7.2 垂直扩展
- 资源优化
- 性能调优
- 缓存策略

### 7.3 功能扩展
- 插件架构
- API 版本控制
- 第三方集成接口 